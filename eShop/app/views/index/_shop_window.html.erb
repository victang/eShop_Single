<br />
<!-- Default itemperpage is 36 item per page -->
<% @tmp_itemperpage = getitemperpage %>
<!-- Get the max page number possible -->
<% @tmp_maxpagenum = getshopitemmaxpagenum %>
<% if params[:page] == nil %>
  <% params[:page] = 1 %>
<% end %>
<% if params[:page].to_i <= 0 %>
  <% params[:page] = 1 %>
<% end %>
<% @tmp_count_from = (params[:page].to_i - 1) * @tmp_itemperpage %>
<% @tmp_count_to = (params[:page].to_i * @tmp_itemperpage) - 1 %>
<%#= @tmp_count_from %>
<%#= @tmp_count_to %>
<!-- Shop window Main Loop - Start -->
  <% if !@shopitems.empty? %>
    <ul class="small-block-grid-3 medium-block-grid-6 large-block-grid-6">
      <% @shopitems.each_with_index do |c, i| %>
        <% next if i < @tmp_count_from %>
        <% break if i > @tmp_count_to %>
        <!-- Start of new row per 6 -->
        <li>
          <!-- Icon and link to sub-page - Start -->
          <a class="th" href="#" data-reveal-id="shopitem_<%= c.id %>">
            <% if c.image.preview_128.file.exists? %>
              <%= image_tag c.image.preview_128.url, :size => "128x128" %>
            <% else %>
              <% if c.image? %>
                <%= image_tag c.image.url, :size => "128x128" %>
              <% else %>
                <%= image_tag 'noimage.gif' %>
              <% end %>
            <% end %>
          </a>
          <!-- Icon and link to sub-page - End -->
          <!-- Sub-page - Start -->
          <div id="shopitem_<%=c.id %>" class="reveal-modal" data-reveal>
            <h3><%= c.short_name %></h3>
            <div class="row">
              <div class="small-6 large-6 columns">
                <!-- Left side is Orbit window - Start -->
                <div class="owl-carousel">
                  <div><%= image_tag c.image.url, :size => "800x800" %></div>
                  <!-- Add extra orbit picture - Start -->
                  <% if !c.shopitem_images.empty? %>
                    <% c.shopitem_images.each do |j| %>
                      <div>
                        <%= image_tag j.image.url, :size => "800x800" %>
                      </div>
                    <% end %>
                  <% end %>
                  <!-- Add extra orbit picture - End-->
                </div>
              </div>
              <!-- Left side is Oribit Window - End -->
              <div class="small-6 large-6 columns">
                <!-- Right side is Description - Start -->
                <table>
                  <tr><td><strong>Full name:</strong></td><td><%= c.long_name %></td></tr>
                  <tr><td><strong>Stock:</strong></td><td><%= c.stock %></td></tr>
                  <tr><td><strong>Price (HKD$):</strong></td><td><%= c.price %></td></tr>
                  <tr><td><strong>Sold:</strong></td><td><%= c.sales %></td></tr>
                  <tr><td colspan="2"><strong>Description:</strong></td></tr>
                  <tr><td colspan="2"><%= h(c.descr).gsub(' ', '&nbsp;').gsub(/\n/, '<br />').html_safe %></td></tr>
                </table>
                <!-- Button for add to cart, and text field to adjust item number-->
                <!-- Right side is Description - End -->
                <% if getcurrentusername != "" && getcurrentusername != "root" %>
                  <div class="row">
                    <div class="small-3 large-3 columns">
                      <input type="number" name="shopitem_<%=c.id%>_cart_amt" id="shopitem_<%=c.id%>_cart_amt" value="1">
                    </div>                  
                    <div class="small-9 large-9 columns">
                      <!-- Testing new button -->
                      <!--
                        <a class="button" href="#" onclick="AddToCartFromIndex(<%=c.id%>, $('#shopitem_<%=c.id%>_cart_amt').val())">Add to Cart</a> 
                      -->
                        <a data-remote="true" data-method="post" class="button" id="shopitem_<%=c.id%>_add" onClick="location.href='/index/add_to_cart/<%=c.id%>/'+$('#shopitem_<%=c.id%>_cart_amt').val()">Add to Cart</a> 
                        
                      <!---->
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
            <a class="close-reveal-modal">&#215;</a>
          </div>
          <!-- Sub-page - End -->
        </li>
      <% end %>
    </ul>
  <% end %>
<!-- Shop window Main Loop - End -->
  
<hr />
  
<!-- Pageination - Start -->
<div class="pagination-centered">
  <ul class="pagination">
    <% if params[:page].to_i <= 1 %>
      <li class="arrow unavailable"><a href="">&laquo;</a></li>
    <% else %>
      <li class="arrow"><%= link_to "&laquo;".html_safe, :controller => :index, :action => :index, :page => params[:page].to_i - 1 %></li>
    <% end %>
    <% (1..@tmp_maxpagenum).each do |j| %>
      <% if j == params[:page].to_i %>
        <li class="current"><%= link_to j, :controller => :index, :action => :index, :page => j %></li>
      <% else %>
        <li><%= link_to j, :controller => :index, :action => :index, :page => j %></li>
      <% end %>
    <% end %>
    <% if params[:page].to_i >= @tmp_maxpagenum %>
      <li class="arrow unavailable"><a href="">&raquo;</a></li>
    <% else %>
      <li class="arrow"><%= link_to "&raquo;".html_safe, :controller => :index, :action => :index, :page => params[:page].to_i + 1 %><li>
    <% end %>
  </ul>
</div>
<!-- Pageination - End -->